{"ast":null,"code":"var _jsxFileName = \"/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/src/pages/Login.js\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { MyContext } from \"../myContext/MyContext\";\nimport Card from \"../components/Card\";\nimport Cookies from \"js-cookie\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Login() {\n  _s();\n\n  const {\n    //state\n    userName,\n    password,\n    result,\n    //functions\n    handleUserNameChange,\n    handlePasswordChange,\n    authenticateWithAPI,\n    setResult,\n    clearForm,\n    setLoggedInUserName,\n    setShowLoggedInMsg\n  } = useContext(MyContext);\n  const history = useHistory();\n\n  const redirectToCreateAccount = () => {\n    history.replace('/createAccount');\n  };\n\n  const redirectToData = () => {\n    history.replace('/allData');\n  }; // const [user, setUser] = useState({\n  // \tusername: \"\",\n  // \tpassword: \"\"\n  // });\n\n\n  async function loginUser() {\n    let userToken = Cookies.get(\"token\");\n\n    if (!userToken) {\n      authenticateWithAPI();\n      userToken = Cookies.get(\"token\");\n    }\n\n    const API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\n    const response = await fetch(`${API_URL}/newusers/login`, {\n      method: \"POST\",\n      headers: userToken && {\n        Authorization: `Bearer ${userToken}`\n      },\n      body: JSON.stringify({\n        username: userName,\n        password: password\n      })\n    });\n    setResult(\"\");\n\n    if (!response.ok) {\n      setResult(response.statusText);\n    } else {\n      const responseObj = await response.json();\n      const result = responseObj.result; //if I don't set state, it doesn't appear on the frontend\n\n      setResult(result);\n\n      if (result === \"success\") {\n        setResult(\"\");\n        setShowLoggedInMsg(false);\n        setLoggedInUserName(responseObj.username);\n        Cookies.set(\"username\", responseObj.username);\n        clearForm();\n        redirectToData();\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(Card, {\n    bgcolor: \"warning\",\n    header: \"Account log in\",\n    body: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [(() => {\n        if (result) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"error\",\n            children: result\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 10\n          }, this);\n        }\n      })(), (() => {\n        if (setShowLoggedInMsg === false) {\n          return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n        }\n      })(), (() => {\n        if (setShowLoggedInMsg === true) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"successMessage\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              children: \"Awesome!\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 105,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Your account was created.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 106,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Please, log in.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 12\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 10\n          }, this);\n        }\n      })(), /*#__PURE__*/_jsxDEV(\"h6\", {\n        className: \"card-text mt-5 mb-2\",\n        children: \"Username\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"input\",\n        className: \"form-control\",\n        id: \"username\",\n        placeholder: \"@\",\n        value: userName,\n        onChange: handleUserNameChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n        className: \"card-text mt-4 mb-2\",\n        children: \"Password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        className: \"form-control\",\n        id: \"password\",\n        placeholder: \"**********\",\n        value: password,\n        onChange: handlePasswordChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: !userName && !password,\n        id: \"submitbutton\",\n        className: \"submitBtn btn btn-light\",\n        onClick: e => loginUser(),\n        children: \"Log in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n        className: \"account-text font-weight-bold mt-4\",\n        children: \"Don't have an account yet?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        id: \"submitbutton\",\n        className: \"submitBtn btn btn-light\",\n        onClick: redirectToCreateAccount,\n        children: \"Open Account\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 3\n  }, this);\n}\n\n_s(Login, \"xGVXaJYCbFNPeteFrQcBlX458Rw=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/src/pages/Login.js"],"names":["React","useContext","useState","useHistory","MyContext","Card","Cookies","Login","userName","password","result","handleUserNameChange","handlePasswordChange","authenticateWithAPI","setResult","clearForm","setLoggedInUserName","setShowLoggedInMsg","history","redirectToCreateAccount","replace","redirectToData","loginUser","userToken","get","API_URL","process","env","NEXT_PUBLIC_API_URL","response","fetch","method","headers","Authorization","body","JSON","stringify","username","ok","statusText","responseObj","json","set","e"],"mappings":"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","sourcesContent":["import React, {useContext, useState} from \"react\";\nimport {useHistory} from \"react-router-dom\";\nimport {MyContext} from \"../myContext/MyContext\";\nimport Card from \"../components/Card\";\nimport Cookies from \"js-cookie\";\n\nfunction Login() {\n\n\tconst {\n\t\t//state\n    userName,\n\t\tpassword,\n\t\tresult,\n\t\t//functions\n\t\thandleUserNameChange,\n\t\thandlePasswordChange,\n\t\tauthenticateWithAPI,\n\t\tsetResult,\n\t\tclearForm,\n\t\tsetLoggedInUserName,\n\t\tsetShowLoggedInMsg,\n\n\t} = useContext(MyContext);\n\n\tconst history = useHistory();\n\n\tconst redirectToCreateAccount = () => {\n\t\thistory.replace('/createAccount');\n  }\n\n\tconst redirectToData = () => {\n\t\thistory.replace('/allData');\n\t}\n\n\t// const [user, setUser] = useState({\n\t// \tusername: \"\",\n\t// \tpassword: \"\"\n\t// });\n\n\tasync function loginUser() {\n\t\n\t\tlet userToken = Cookies.get(\"token\");\n\t\tif (!userToken) {\n\t\t\tauthenticateWithAPI();\n\t\t\tuserToken = Cookies.get(\"token\");\n\t\t}\n\t\t\n\t\tconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\n\t\tconst response = await fetch(`${API_URL}/newusers/login`, {\n\t\t  method: \"POST\",\n\t\t\theaders: userToken && { Authorization: `Bearer ${userToken}` },\n\t\t \tbody: JSON.stringify({\n\t\t\t\tusername: userName,\n\t\t\t\tpassword: password,\n\t\t  }),\n\t\t});\n\n\t\tsetResult(\"\");\n\t\tif (!response.ok) {\n\t\t \tsetResult(response.statusText);\n\t\t} else {\n\t\t\tconst responseObj = await response.json();\n\t\t\tconst result = responseObj.result;\n\t\t\t//if I don't set state, it doesn't appear on the frontend\n\t\t\tsetResult(result);\n\t\t\tif (result === \"success\") { \n\t\t\t\tsetResult(\"\");\n\t\t\t\tsetShowLoggedInMsg(false)\n\t\t\t\tsetLoggedInUserName(responseObj.username);\n\t\t\t\tCookies.set(\"username\", responseObj.username);\n\t\t\t\tclearForm();\n\t\t\t\tredirectToData();\n\t\t\t} \n\t\t}\n\t}\t\n\n\treturn (\n\t\t<Card\n\t\t\tbgcolor=\"warning\"\n\t\t\theader=\"Account log in\"\n\t\t\tbody={\n\t\t\t\t<>\n\n\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"error\">{result}</div>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (setShowLoggedInMsg === false) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (setShowLoggedInMsg === true) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"successMessage\">\n\t\t\t\t\t\t\t\t\t\t\t<h5>Awesome!</h5>\n\t\t\t\t\t\t\t\t\t\t\t<p>Your account was created.</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>Please, log in.</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\t\t\t\t\t\n\t\t\t\t\t<h6 className=\"card-text mt-5 mb-2\">Username</h6>\n\t\t\t\t\t<input type=\"input\" className=\"form-control\" id=\"username\" placeholder=\"@\" value={userName} onChange={handleUserNameChange}/>\n\t\t\t\t\t<h6 className=\"card-text mt-4 mb-2\">Password</h6>\n\t\t\t\t\t<input type=\"password\" className=\"form-control\" id=\"password\" placeholder=\"**********\" value={password} onChange={handlePasswordChange}/>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button type=\"submit\" disabled={!userName && !password} id=\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={e => loginUser()}>Log in</button>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<h6 className=\"account-text font-weight-bold mt-4\">Don't have an account yet?</h6>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button type=\"submit\" id=\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={redirectToCreateAccount}>Open Account</button>\n\t\t\t\t</>\n\t\t\t\t}\n\t\t/>\n\t)\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}