{"ast":null,"code":"import _asyncToGenerator from\"/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useState}from\"react\";import{useHistory,useLocation}from\"react-router-dom\";import{MyContext}from\"../myContext/MyContext\";import Card from\"../components/Card\";import Cookies from\"js-cookie\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){var _useContext=useContext(MyContext),userName=_useContext.userName,password=_useContext.password,result=_useContext.result,handleUserNameChange=_useContext.handleUserNameChange,handlePasswordChange=_useContext.handlePasswordChange,authenticateWithAPI=_useContext.authenticateWithAPI,setResult=_useContext.setResult,clearForm=_useContext.clearForm,setLoggedInUserName=_useContext.setLoggedInUserName,setShowLoggedInMsg=_useContext.setShowLoggedInMsg;var location=useLocation();/*\n\tThe useHistory hook allows us to access React Router's history object.\n\tThrough the history object, we can access and manipulate the current state of the browser history.\n\tAll we need to do is to call the useHistory hook inside a functional component.\n\tWe can use this object to redirect the user to another page by calling history.push('/example-route').\n\t*/ //redirects me to Create Account when clicking \"Open Account\" in Login \nvar history=useHistory();var redirectToCreateAccount=function redirectToCreateAccount(){history.replace('/createAccount');};var redirectToData=function redirectToData(){history.replace('/allData');};function loginUser(){return _loginUser.apply(this,arguments);}function _loginUser(){_loginUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userToken,API_URL,response,responseObj,_result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userToken=Cookies.get(\"token\");if(!userToken){authenticateWithAPI();userToken=Cookies.get(\"token\");}API_URL=process.env.NEXT_PUBLIC_API_URL||\"http://localhost:1337\";_context.next=5;return fetch(\"\".concat(API_URL,\"/newusers/login\"),{method:\"POST\",headers:userToken&&{Authorization:\"Bearer \".concat(userToken)},body:JSON.stringify({username:userName,password:password})});case 5:response=_context.sent;setResult(\"\");if(response.ok){_context.next=11;break;}setResult(response.statusText);_context.next=17;break;case 11:_context.next=13;return response.json();case 13:responseObj=_context.sent;_result=responseObj.result;//if I don't set state, it doesn't appear on the frontend\nsetResult(_result);if(_result===\"success\"){setResult(\"\");setShowLoggedInMsg(false);setLoggedInUserName(responseObj.username);Cookies.set(\"username\",responseObj.username);clearForm();redirectToData();}case 17:case\"end\":return _context.stop();}}},_callee);}));return _loginUser.apply(this,arguments);}return/*#__PURE__*/_jsx(Card,{bgcolor:\"warning\",header:\"Account log in\",body:/*#__PURE__*/_jsxs(_Fragment,{children:[function(){if(result){return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:result});}}(),function(){if(setShowLoggedInMsg===false){return/*#__PURE__*/_jsx(_Fragment,{});}}(),function(){if(location.state&&location.state.isRedirectFromCreateAccount){return/*#__PURE__*/_jsxs(\"div\",{className:\"successMessage\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Awesome!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your account was created.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please, log in.\"})]});}}(),/*#__PURE__*/_jsx(\"h6\",{className:\"card-text mt-5 mb-2\",children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"input\",className:\"form-control\",id:\"username\",placeholder:\"@\",value:userName,onChange:handleUserNameChange}),/*#__PURE__*/_jsx(\"h6\",{className:\"card-text mt-4 mb-2\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",id:\"password\",placeholder:\"**********\",value:password,onChange:handlePasswordChange}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!userName&&!password,id:\"submitbutton\",className:\"submitBtn btn btn-light\",onClick:function onClick(e){return loginUser();},children:\"Log in\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h6\",{className:\"account-text font-weight-bold mt-4\",children:\"Don't have an account yet?\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",id:\"submitbutton\",className:\"submitBtn btn btn-light\",onClick:redirectToCreateAccount,children:\"Open Account\"})]})});}export default Login;","map":{"version":3,"sources":["/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/src/pages/Login.js"],"names":["React","useContext","useState","useHistory","useLocation","MyContext","Card","Cookies","Login","userName","password","result","handleUserNameChange","handlePasswordChange","authenticateWithAPI","setResult","clearForm","setLoggedInUserName","setShowLoggedInMsg","location","history","redirectToCreateAccount","replace","redirectToData","loginUser","userToken","get","API_URL","process","env","NEXT_PUBLIC_API_URL","fetch","method","headers","Authorization","body","JSON","stringify","username","response","ok","statusText","json","responseObj","set","state","isRedirectFromCreateAccount","e"],"mappings":"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","sourcesContent":["import React, {useContext, useState} from \"react\";\nimport {useHistory, useLocation} from \"react-router-dom\";\nimport {MyContext} from \"../myContext/MyContext\";\nimport Card from \"../components/Card\";\nimport Cookies from \"js-cookie\";\n\nfunction Login() {\n\n\tconst {\n\t\t//state\n    userName,\n\t\tpassword,\n\t\tresult,\n\t\t//functions\n\t\thandleUserNameChange,\n\t\thandlePasswordChange,\n\t\tauthenticateWithAPI,\n\t\tsetResult,\n\t\tclearForm,\n\t\tsetLoggedInUserName,\n\t\tsetShowLoggedInMsg,\n\n\t} = useContext(MyContext);\n\n\tconst location = useLocation();\n\n\t/*\n\tThe useHistory hook allows us to access React Router's history object.\n\tThrough the history object, we can access and manipulate the current state of the browser history.\n\tAll we need to do is to call the useHistory hook inside a functional component.\n\tWe can use this object to redirect the user to another page by calling history.push('/example-route').\n\t*/\n\n\t//redirects me to Create Account when clicking \"Open Account\" in Login \n\tconst history = useHistory();\n\n\tconst redirectToCreateAccount = () => {\n\t\thistory.replace('/createAccount');\n  }\n\n\tconst redirectToData = () => {\n\t\thistory.replace('/allData');\n\t}\n\n\n\tasync function loginUser() {\n\t\n\t\tlet userToken = Cookies.get(\"token\");\n\t\tif (!userToken) {\n\t\t\tauthenticateWithAPI();\n\t\t\tuserToken = Cookies.get(\"token\");\n\t\t}\n\t\t\n\t\tconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\n\t\tconst response = await fetch(`${API_URL}/newusers/login`, {\n\t\t  method: \"POST\",\n\t\t\theaders: userToken && { Authorization: `Bearer ${userToken}` },\n\t\t \tbody: JSON.stringify({\n\t\t\t\tusername: userName,\n\t\t\t\tpassword: password,\n\t\t  }),\n\t\t});\n\n\t\tsetResult(\"\");\n\t\tif (!response.ok) {\n\t\t \tsetResult(response.statusText);\n\t\t} else {\n\t\t\tconst responseObj = await response.json();\n\t\t\tconst result = responseObj.result;\n\t\t\t//if I don't set state, it doesn't appear on the frontend\n\t\t\tsetResult(result);\n\t\t\tif (result === \"success\") { \n\t\t\t\tsetResult(\"\");\n\t\t\t\tsetShowLoggedInMsg(false)\n\t\t\t\tsetLoggedInUserName(responseObj.username);\n\t\t\t\tCookies.set(\"username\", responseObj.username);\n\t\t\t\tclearForm();\n\t\t\t\tredirectToData();\n\t\t\t} \n\t\t}\n\t}\t\n\n\treturn (\n\t\t<Card\n\t\t\tbgcolor=\"warning\"\n\t\t\theader=\"Account log in\"\n\t\t\tbody={\n\t\t\t\t<>\n\n\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"error\">{result}</div>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (setShowLoggedInMsg === false) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (location.state && location.state.isRedirectFromCreateAccount) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"successMessage\">\n\t\t\t\t\t\t\t\t\t\t\t<h5>Awesome!</h5>\n\t\t\t\t\t\t\t\t\t\t\t<p>Your account was created.</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>Please, log in.</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\t\t\t\t\t\n\t\t\t\t\t<h6 className=\"card-text mt-5 mb-2\">Username</h6>\n\t\t\t\t\t<input type=\"input\" className=\"form-control\" id=\"username\" placeholder=\"@\" value={userName} onChange={handleUserNameChange}/>\n\t\t\t\t\t<h6 className=\"card-text mt-4 mb-2\">Password</h6>\n\t\t\t\t\t<input type=\"password\" className=\"form-control\" id=\"password\" placeholder=\"**********\" value={password} onChange={handlePasswordChange}/>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button type=\"submit\" disabled={!userName && !password} id=\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={e => loginUser()}>Log in</button>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<h6 className=\"account-text font-weight-bold mt-4\">Don't have an account yet?</h6>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button type=\"submit\" id=\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={redirectToCreateAccount}>Open Account</button>\n\t\t\t\t</>\n\t\t\t\t}\n\t\t/>\n\t)\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}