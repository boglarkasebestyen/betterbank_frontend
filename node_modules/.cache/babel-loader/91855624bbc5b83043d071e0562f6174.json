{"ast":null,"code":"import _asyncToGenerator from\"/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useEffect}from\"react\";import{MyContext}from\"../myContext/MyContext\";import Card from\"../components/Card\";import Cookies from\"js-cookie\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Transfer(){var _useContext=useContext(MyContext),balance=_useContext.balance,transferAmount=_useContext.transferAmount,transferError=_useContext.transferError,error=_useContext.error,destinationUser=_useContext.destinationUser,loggedInUserName=_useContext.loggedInUserName,validateTransfer=_useContext.validateTransfer,transferSuccessMessageVisible=_useContext.transferSuccessMessageVisible,setError=_useContext.setError,authenticateWithAPI=_useContext.authenticateWithAPI,setTransferSuccessMessageVisible=_useContext.setTransferSuccessMessageVisible,setTransferAmount=_useContext.setTransferAmount,getBalance=_useContext.getBalance,setDestinationUser=_useContext.setDestinationUser,transferHandleChange=_useContext.transferHandleChange,handleDestinationUserNameChange=_useContext.handleDestinationUserNameChange;useEffect(function(){getBalance();});function submitTransfer(){return _submitTransfer.apply(this,arguments);}function _submitTransfer(){_submitTransfer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userToken,username,API_URL,response,responseObj,_error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(validateTransfer()){_context.next=2;break;}return _context.abrupt(\"return\");case 2:userToken=Cookies.get(\"token\");if(!userToken){authenticateWithAPI();userToken=Cookies.get(\"token\");}username=Cookies.get(\"username\");console.log(\"to:\"+destinationUser+\"from: \"+username);API_URL=process.env.NEXT_PUBLIC_API_URL||\"http://localhost:1337\";_context.next=9;return fetch(\"\".concat(API_URL,\"/transactions/transfer\"),{method:\"POST\",headers:userToken&&{Authorization:\"Bearer \".concat(userToken)},body:JSON.stringify({to:destinationUser,from:username,amount:transferAmount})});case 9:response=_context.sent;setError(\"\");if(response.ok){_context.next=16;break;}console.log(response.statusText);setError(response.statusText);_context.next=22;break;case 16:_context.next=18;return response.json();case 18:responseObj=_context.sent;_error=responseObj.error;if(_error){setError(_error);setTransferSuccessMessageVisible(false);}else{setTransferSuccessMessageVisible(true);}getBalance();case 22:;case 23:case\"end\":return _context.stop();}}},_callee);}));return _submitTransfer.apply(this,arguments);};var clearMsgTransfer=function clearMsgTransfer(){setTransferAmount(\"\");setDestinationUser(\"\");setTransferSuccessMessageVisible(false);};return/*#__PURE__*/_jsx(Card,{bgcolor:\"warning\",header:\"Transfer\",body:/*#__PURE__*/_jsxs(_Fragment,{children:[function(){if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error});}}(),function(){if(transferError){return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:transferError});}}(),function(){if(transferSuccessMessageVisible===true){return/*#__PURE__*/_jsxs(\"div\",{className:\"successMessage\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Awesome!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your transfer went through!\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",id:\"submitbutton\",className:\"submitBtn btn btn-light\",onClick:function onClick(){return clearMsgTransfer();},children:\"Ok\"})]});}}(),/*#__PURE__*/_jsxs(\"h6\",{className:\"card-text mt-4 mb-5 font-weight-bolder\",children:[\"Your current balance is: $\",balance]}),/*#__PURE__*/_jsx(\"h6\",{className:\"card-text mt-4 mb-2 font-weight-bolder\",children:\"The amount you wish to transfer:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"input\",className:\"form-control\",id:\"transferAmount\",value:transferAmount,onChange:transferHandleChange}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h6\",{className:\"card-text mt-4 mb-2 font-weight-bolder\",children:\"Username the amount goes to:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"input\",className:\"form-control\",id:\"destinationUser\",value:destinationUser,onChange:handleDestinationUserNameChange}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!transferAmount||!destinationUser,id:\"submitbutton\",className:\"submitBtn btn btn-light\",onClick:function onClick(){return submitTransfer();},children:\"Transfer\"})]})});}export default Transfer;","map":{"version":3,"sources":["/Users/sebestyenboglarka/Desktop/_uWu/MIT_MERN_2021-'22/3rd semester/badbank_backend_test/betterbank_frontend/src/pages/Transfer.js"],"names":["React","useContext","useEffect","MyContext","Card","Cookies","Transfer","balance","transferAmount","transferError","error","destinationUser","loggedInUserName","validateTransfer","transferSuccessMessageVisible","setError","authenticateWithAPI","setTransferSuccessMessageVisible","setTransferAmount","getBalance","setDestinationUser","transferHandleChange","handleDestinationUserNameChange","submitTransfer","userToken","get","username","console","log","API_URL","process","env","NEXT_PUBLIC_API_URL","fetch","method","headers","Authorization","body","JSON","stringify","to","from","amount","response","ok","statusText","json","responseObj","clearMsgTransfer"],"mappings":"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","sourcesContent":["import React, {useContext, useEffect} from \"react\";\nimport {MyContext} from \"../myContext/MyContext\";\nimport Card from \"../components/Card\";\nimport Cookies from \"js-cookie\";\n\nfunction Transfer() {\n\n\tconst {\n\t\t//state:\n\t\tbalance,\n\t\ttransferAmount,\n\t\ttransferError,\n\t\terror,\n\t\tdestinationUser,\n\t\tloggedInUserName,\n\t\t//functions:\n\t\tvalidateTransfer,\n\t\ttransferSuccessMessageVisible,\n\t\tsetError,\n\t\tauthenticateWithAPI ,\n\t\tsetTransferSuccessMessageVisible,\n\t\tsetTransferAmount,\n\t\tgetBalance,\n\t\tsetDestinationUser,\n\t\ttransferHandleChange,\n\t\thandleDestinationUserNameChange\n\t} = useContext(MyContext);\n\n\tuseEffect(()=> {\n\t\tgetBalance();\n\t}); \n\n\n\tasync function submitTransfer() {\n\t\tif(!validateTransfer()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet userToken = Cookies.get(\"token\");\n\t\t\tif (!userToken) {\n\t\t\t\tauthenticateWithAPI();\n\t\t\t\tuserToken = Cookies.get(\"token\");\n\t\t\t}\n\n\t\t\tlet username = Cookies.get(\"username\");\n\t\t\tconsole.log(\"to:\" + destinationUser + \"from: \" + username)\n\t\t\t\n\t\t\tconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\n\t\t\tconst response = await fetch(`${API_URL}/transactions/transfer`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: userToken && { Authorization: `Bearer ${userToken}` },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tto: destinationUser,\n\t\t\t\t\tfrom: username,\n\t\t\t\t\tamount: transferAmount\n\t\t\t\t}),\n\t\t\t});\n\n\t\tsetError(\"\");\n    if (!response.ok) {\n\t\t\tconsole.log(response.statusText)\n\t\t  setError(response.statusText);\n\t\t} else {\n\t\t\tconst responseObj = await response.json();\n\t\t\tconst error = responseObj.error;\n\t\t\tif (error) {\n\t\t\t\tsetError(error);\n        setTransferSuccessMessageVisible(false)\n\t\t\t} else {\n        setTransferSuccessMessageVisible(true);\n      }\n\t\t\tgetBalance();\n\t\t};\n  };\n\n  let clearMsgTransfer = () => {\n    setTransferAmount(\"\");\n\t\tsetDestinationUser(\"\");\n    setTransferSuccessMessageVisible(false);\n  }\n\n\treturn (\n\t\t<Card\n\t\t\t\tbgcolor=\"warning\"\n\t\t\t\theader=\"Transfer\"\n\t\t\t\tbody= {\n\t\t\t\t\t<>  \n\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"error\">{error}</div>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (transferError) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"error\">{transferError}</div>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\tif (transferSuccessMessageVisible === true) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div className=\"successMessage\">\n\t\t\t\t\t\t\t\t\t\t<h5>Awesome!</h5>\n\t\t\t\t\t\t\t\t\t\t<p>Your transfer went through!</p>\n\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" id=\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={() => clearMsgTransfer()}>Ok</button>             \n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t<h6 className=\"card-text mt-4 mb-5 font-weight-bolder\">Your current balance is: ${balance}</h6>\n\t\t\t\t\t\n\t\t\t\t\t\t{/* amount */}\n\t\t\t\t\t\t<h6 className=\"card-text mt-4 mb-2 font-weight-bolder\">The amount you wish to transfer:</h6>\n\t\t\t\t\t\t{/* added value so that state can change */}\n\t\t\t\t\t\t<input type=\"input\" className=\"form-control\" id=\"transferAmount\" value={transferAmount} onChange={transferHandleChange}/>\n\t\t\t\t\t\t<br/>  \n\t\t\t\t\t\t\n\t\t\t\t\t\t{/* user */}\n\t\t\t\t\t\t<h6 className=\"card-text mt-4 mb-2 font-weight-bolder\">Username the amount goes to:</h6>\n\t\t\t\t\t\t{/* added value so that state can change */}\n\t\t\t\t\t\t<input type=\"input\" className=\"form-control\" id=\"destinationUser\" value={destinationUser} onChange={handleDestinationUserNameChange}/>\n\t\t\t\t\t\t<br/>                                                                              \n\t\t\t\t\t\t<button type=\"submit\" disabled={!transferAmount || !destinationUser} id =\"submitbutton\" className=\"submitBtn btn btn-light\" onClick={() => submitTransfer()}>Transfer</button>            \n\t\t\t\t\t</>\n\t\t\t\t}  \n\t\t/>\n\t)\n}\n\nexport default Transfer;"]},"metadata":{},"sourceType":"module"}